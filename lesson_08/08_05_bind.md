# Вариант 4. Монада Result и оператор bind.

Исключения дали нам возможность сосредоточиться на happy path и не мучиться с шаблонной обработкой ошибок. В функциональном программировании есть другие инструменты с таким же эффектом.

В нашем примере есть несколько функций, которые возвращают результат вида `{:ok, result} | {:error, reason}`. Во многих функциональных языках для такой контрукции есть специальный тип данных. 

Haskell: ` Result e v `

OCaml: ` Ok of 'a | Error of 'b `

Scala: ` Either[+A, +B] `

Rust: ` Result<T, E> `

Этот тип данных означает, что результатом вызова функции могут быть два варианта: либо успешный результат, либо ошибка. То есть, возвращаемое значение отдается не напрямую, а завернутое в некую оболочку, контекст. Такое значение называется **монада**. Монады бывают разные, и Result -- одна из них. 

Если одна функция возвращает монаду Result, а другая принимает значение в чистом виде, то чтобы соединить эти две функции, нужно извлечь значение из монады. Это мы уже делали во 2-м варианте решения:

```
case f1(arg) do
  {:ok, data} -> f2(data)
  {:error, reason} -> {:error, reason}
end
```

Этот case мы явно писали каждый раз, когда соединяли функции. Такого рода соединение (композиция) функций -- очень частый паттерн в функциональном программировании. И в некоторых языках для него есть обобщенное решение. 

На Эликсир это можно реализовать так: bookshop/lib/fp.ex

```
iex(9)> FP.main
{:ok, {:cat, ...}}}
iex(10)> FP.main
{:error, :cat_not_found}
iex(11)> FP.main
{:error, :cat_not_found}
iex(12)> FP.main
{:error, :invalid_incoming_data}
```

Мы реализовали функцию **bind**, которая связывает две любые функции, где первая возвращает монаду Result. 

Если нужно связать несколько функций в цепочку, то это будет выглядеть так:

```
bind(bind(bind(f1, f2), f3), f4)
```

В Haskell и других языках есть аналогичный оператор:

```
f1 >>= f2 >>= f3 >>= f4
```

Как видим, с оператором это гораздо удобнее и писать, и читать.


TODO: solution 4 как здесь:
https://github.com/yzh44yzh/erl_fun_composition/blob/master/src_hs/Main4.hs


