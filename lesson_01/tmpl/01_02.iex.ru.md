# Интерактивная консоль (iex)

Посмотрим на интерактивную консоль **iex** -- второй по важности, после редактора, инструмент разработчика.

Многие языки программирования имеют REPL консоль. Она дает возможность работать интеративно: запускать небольшие куски кода и сразу же видеть результ. REPL означает Read, Eval, Print, Loop. То есть, консоль читает код, выполняет его, выводит результат, и опять читает код.

Мы уже начали активно пользоваться консолью когда реализовывали FizzBuzz, и в процессе активно переключались между редактором кода и консолью.

Теперь познакомимся с ней поближе:

```elixir
{{# source}}session_04.txt:start{{/ source}}
```

Мы видим версию Эрланг: `Erlang/OTP 23`, версию Erlang Runtime System: `erts-11.1` и версию Эликсир: `Elixir (1.13.4)`.


## Компиляция

iex-консоль имеет много встроенных функций. Самые популярные из них имеют короткие названия, зачастую в одну букву. 

Мы уже пользовались функцией `c`, которая компилирует и загружает код:

```elixir
{{# source}}session_04.txt:compile{{/ source}}
```

Другая популярная функция -- это `h`, которая показывает справку по функциям и модулям Эликсир. Посмотрим справку по функции `c`:

```elixir
{{# source}}session_04.txt:compile_help{{/ source}}
```

Мы видим, что функция `c` компилирует один или несколько файлов, загружает их в память консоли, или сохраняет сгенерированный байт-код по указаному пути. 

Если мы вносим изменения в код, то с помощью функции `r` мы можем перекомпилировать модуль заново и загрузить свежую версию.

```elixir
{{# source}}session_04.txt:recompile{{/ source}}
```

Таким образом удобно вести интерактивную разработку -- писать код и тут же проверять в консоли, как он работает. 

Для больших проектов неудобно перекомпилировать по-отдельности каждый измененный модуль. Поэтому в консоли есть функция `recompile`, которая пересобирает весь проект. Однако, для этого нужно иметь полноценный проект с правильной структурой кода, а не просто несколько модулей.


## Автодополнение

Для кода, который скомпилирован и загружен в консоль, работает автодополнение модулей и функций:

```elixir
{{# source}}session_04.txt:autocomplete{{/ source}}
```

## Интроспекция

Еще одна полезная короткая функция -- это `i`. Это интроспеция, которая показывает информацию о значениях и переменных:

```elixir
{{# source}}session_04.txt:introspection{{/ source}}
```

## История

Как и большинство других консолей, iex-консоль сохраняет историю команд и позволяет перемещатсья по ней с помощью горячих клавиш `Ctrl-p` и `Ctrl-n` или стрелками.

Также консоль позволяет обратиться к результатам предыдущих команд с помощью функции `v`. Эта функция принимает номер строки, и возвращает результат команды из этой строки. Её также можно вызвать без аргументов, тогда она вернет результат предыдущей команды:

```elixir
{{# source}}session_04.txt:history{{/ source}}
```


## Справка

Рассмотрим подробнее функцию `h`. Если вызывать ее без аргументов, то мы увидим справку по самой консоли iex. 

Аргументом можно передать имя модуля, функции или макроса. Тогда консоль покажет справку по ним:

```elixir
{{# source}}session_04.txt:help{{/ source}}
```

В каждый модуль при компиляции автоматически добавляется функция module_info, которая возращает некоторые метаданные об этом модуле. Это справедливо как для библиотечных модулей, так и для модулей, которые мы создаем сами:

```elixir
{{# source}}session_04.txt:module_info{{/ source}}
```

## Справка по собственным модулям

Мы можем добавить документацию в собственные модули, и эта документация будет доступна в iex-консоли. 

TODO: FizzBuzz04 с документацией

Однако это не работает, если модуль просто скомпилирован из консоли:

```elixir
{{# source}}session_04.txt:fizzbuzz_help{{/ source}}
```

Нужно, чтобы скомпилированный байткод был сохранён на диске. Для этого функцию `c` вызываем с двумя аргументами -- кроме файла исходников ещё указываем путь, куда сохранять beam-файл:

```elixir
{{# source}}session_04.txt:fizzbuzz_help_2{{/ source}}
```

## runtime_info

Рассмотрим еще функцию `runtime_info`. Длинное название этой функции подразумевает, что она не используется так же часто, как `c`, `h`, `i` или `v`.

Функция выводит полезную информацию о текущем состоянии виртуальной машины: версии Эликсир и Эрлаг, количество планировщиков, потребление памяти, количество процессов и др.

```elixir
{{# source}}session_04.txt:runtime_info{{/ source}}
```

Как видно, iex-консоль очень полезна, и мы будем активно её использовать на протяжении всего курса.
