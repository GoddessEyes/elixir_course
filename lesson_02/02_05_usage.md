# Сфера применения BEAM

Протокол HTTP решает проблему, как одному серверу обслужить много клиентов. Это возможно благодаря двум ограничениям:

- короткое время жизни соединения,
- отстутствие состояния.

Серверу достаточно иметь небольшой пул процессов, чтобы обрабатывать значительно большее количество соединений, потому что один процесс может быстро переключаться между ними.

Но всё становится гораздо сложнее, когда соединение долгоживущее. Если специфика сервиса такова, что TCP-соединение живет не миллисекунды, а минуты, часы, и даже недели, то одному процессу становится сложно переключаться между ними. Хуже того, у долгоживущего соединения как правило есть состояние. 

Это требует другой архитектуры системы. Сервер вынужден выделять отдельный процесс на каждое соединение. И его способность масштабироваться ограничена количеством процессов, которые он может запустить.

И вот тут архитектура BEAM показывает себя с лучшей стороны. Для BEAM не сложно запустить отдельный процесс на каждое соединение, и при этом держать несколько сотен тысяч соединений одновременно.

Классический пример таких систем -- это мессенджеры и многопользовательские чаты. Не зря история не-эрикссоновского Эрланга началась с ejabberd. Эликсир и Эрланг до сих пор популярны в этой сфере. 

BEAM позволяет строить большие системы, обслуживающие большое количество клиентов с долгоживущими соединениями, относительно небольшими ресурсами и небольшой командой инженеров. Хорошим примером такой системы и такой команды является **WhatsUp**.

Золотое время WhatsUp пришлось на начало 2010-х годов. В 2012 году компания имела 450 миллионов активных пользователей и только 32 инженера. 8000 процессорных ядер обрабатывали 35 миллионов сообщений в минуту (500 тысяч в секунду). Один сервер с 24 ядрами CPU и 100GB RAM обслуживал 2 миллиона одновременных соединений. Сервер WhatsApp практически полностью написан на Эрланг и вырос из ejabberd.

Тем же путем прошел чат-сервер в компании **Wargaming**. Он начался с ejabberd, но потом вырос в самостоятельный проект, где не осталось кода из ejabberd. Он не достиг таких высот, как сервер WhatsUp. Один узел с 8 ядрами CPU обслуживает 300 тысяч соединений и 12 тысяч запросов в секунду, что тоже весьма достойно.

TODO: другие применения
MQ и базы данных тоже работают долгоживущими TCP соединениями.
RabbitMQ, Riak


# Сфера применения Эликсир

Эликсир начинался иначе, его авторы имели совсем другой опыт. Жозе Валим был одним из разработчиков Ruby on Rails. Этот фреймворк, при всех своих достоинствах, довольно медленный. Его трудно масштабировать, и это ограничивает его применение.

Изначальная идея Эликсир была в том, чтобы решить проблему масштабирования веб-фреймворка. А для этого нужен был не только новый язык, но и новый веб-фреймворк. Не случайно Phoniex начал разрабатываться и появился почти одновременно с Эликсир.

С веб-фреймворком все получилось хорошо. Но нет причин на этом останавлисаться. Учитывая полную совместимость Эликсир и Эрланг на уровне байткода, всё, что может BEAM, может и Эликсир. 

Оказалось, что в Phoniex довольно легко добавить веб-сокеты, а затем LiveView. Потому что это все те же долгоживущие соединения, с которыми легко справляется BEAM. 

Надо заметить, что Эрланг не часто используется для создания веб-приложений. На нем с упехом делают HTTP-сервера с JSON API (JSON на входе, JSON на выходе). Но если речь идет о комплексном решении, включающем фронтенд и бэкенд, то Эрланг не очень популярен.

Таким образом Эликсир расширяет сферу применения BEAM.

